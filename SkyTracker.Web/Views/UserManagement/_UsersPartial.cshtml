@using X.PagedList.Mvc.Core;
@using X.PagedList.Web.Common;
@model X.PagedList.IPagedList<UserViewModel>

<h2 class="text-center">@ViewBag.Title</h2>

<p>
    <button id="promoteSelected" class="btn btn-primary">Promote to Admin</button>
    <button id="goToAdminsList" class="btn btn-light">List of Current Admins</button>
    <button id="lockOutSelected" class="btn btn-warning">Lockout Selected</button>
    <button id="goToLockedOutList" class="btn btn-light">List of Locked Users</button>
</p>


<div id="userListContainer">
    <table class="table table-striped">
        <thead>
            <tr>
                <th></th>
                <th>Username</th>
                <th>Email</th>
                <th>Phonenumber</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in @Model)
            {
                <tr id="row-@item.Id">
                    <td><input type="checkbox" name="selectedUsers" value="@item.Id" /></td>
                    <td>@item.Username</td>
                    <td>@item.Email</td>
                    <td>@item.PhoneNumber</td>
                </tr>
            }
        </tbody>
    </table>
</div>
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">

        @Html.PagedListPager(Model, page => {
        if (page == 1)
        return Url.Action("UsersPartial");
        else
        return Url.Action("UsersPartial", new { page });
        }, new PagedListRenderOptions {
        DisplayLinkToFirstPage = PagedListDisplayMode.IfNeeded,
        ContainerDivClasses = new[] { "pagination" },
        LiElementClasses = new[] { "page-item" },
        PageClasses = new[] { "page-link" },
        })
    </ul>
</nav>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


<script>
    $(document).ready(function () {
        $('#promoteSelected').click(function () {
            var selectedUsers = $('input[name="selectedUsers"]:checked');
            var selectedIds = [];

            selectedUsers.each(function () {
                selectedIds.push($(this).val());
            });

            if (selectedIds.length === 0) {
                alert('Please select at least one user.');
                return;
            }

            if (confirm('Are you sure you want to promote the selected users?')) {
                $.ajax({
                    url: '@Url.Action("Promote", "UserManagement")',
                    type: 'POST',
                    data: { userIds: selectedIds },
                    success: function (result) {
                        if (result.success) {
                            selectedUsers.closest('tr').remove();
                        } else {
                            alert('An error occurred while promoting the users. Please try again.');
                        }
                    },
                    error: function () {
                        alert('An error occurred while promoting the users. Please try again.');
                    }
                });
            }
        });

        $('#goToAdminsList').click(function () {
            // Load the normal "Admins" partial view
            loadPartialViewOnClick('@Url.Action("AdminsListPartial", "UserManagement")');
        });

        $('#lockOutSelected').click(function () {
            var selectedUsers = $('input[name="selectedUsers"]:checked');
            var selectedIds = [];

            selectedUsers.each(function () {
                selectedIds.push($(this).val());
            });

            if (selectedIds.length === 0) {
                alert('Please select at least one user.');
                return;
            }

            if (confirm('Are you sure you want to lockout the selected users?')) {
                $.ajax({
                    url: '@Url.Action("Lockout", "UserManagement")',
                    type: 'POST',
                    data: { userIds: selectedIds },
                    success: function (result) {
                        if (result.success) {
                            selectedUsers.closest('tr').remove();
                        } else {
                            alert('An error occurred while locking the users. Please try again.');
                        }
                    },
                    error: function () {
                        alert('An error occurred while locking the users. Please try again.');
                    }
                });
            }
        });

        $('#goToLockedOutList').click(function () {
            // Load the normal "Admins" partial view
            loadPartialViewOnClick('@Url.Action("LockedUsersPartial", "UserManagement")');
        });
    });
</script>